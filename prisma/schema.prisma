generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  ADMIN
  STUDENT
  TUTOR
}

enum BookingStatus {
  CONFIRMED
  COMPLETED
  CANCELLED
}

enum UserStatus {
  ACTIVE
  BANNED
}

model User {
  id       String   @id @default(uuid())
  name     String
  email    String   @unique
  password String
  role     UserRole @default(STUDENT)
  isBanned Boolean  @default(false)
  image    String?

  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  tutorsProfiles TutorProfile?
  bookings       Booking[]
  reviews        Review[]

  @@index([isBanned])
  @@map("users")
}

model TutorProfile {
  id String @id @default(uuid())

  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  bio          String
  subject      String
  availability Boolean @default(true)
  hourlyRate   Float

  categoryId String
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Restrict)

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  bookings  Booking[]
  reviews   Review[]

  @@index([subject])
  @@index([categoryId])
  @@map("tutor_profiles")
}

model Category {
  id            String         @id @default(uuid())
  name          String
  tutorsProfile TutorProfile[]

  @@map("categories")
}

model Booking {
  id String @id @default(uuid())

  studentId String
  user      User   @relation(fields: [studentId], references: [id])

  tutorId String
  tutor   TutorProfile @relation(fields: [tutorId], references: [id])

  startTime   DateTime
  endTime     DateTime
  bookingDate DateTime      @default(now())
  status      BookingStatus @default(CONFIRMED)
  totalPrice  Float

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("bookings")
}

model Review {
  id      String @id @default(uuid())
  rating  Int
  comment String

  userId String
  user   User   @relation(fields: [userId], references: [id])

  tutorId String
  tutor   TutorProfile @relation(fields: [tutorId], references: [id])

  createdAt DateTime @default(now())

  @@map("reviews")
}
